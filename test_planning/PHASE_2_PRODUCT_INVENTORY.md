# راهنمای تست فاز ۲: مدیریت محصول و انبار (Product & Inventory)

این سند شامل دستورالعمل‌های تست دستی و نتایج تست‌های خودکار برای ماژول محصولات و انبار است.

## پیش‌نیازها
1.  **لاگین ادمین**: باید با کاربر ادمین (`admin`) لاگین باشید.
    *   نام کاربری: `admin`
    *   رمز عبور: `admin123`
    *   در تست دستی، ابتدا به `/auth/login` بروید و لاگین کنید.

---

## 1. مدیریت محصول (Product Management)

### الف) ایجاد محصول جدید (Create Product)
**سناریو**: ایجاد یک محصول با نام "انگشتر طلای تست" و قیمت "۱۰,۰۰۰,۰۰۰ تومان".
**روش تست دستی**:
1.  به صفحه محصولات یا داشبورد ادمین بروید (مثلا `/dashboard/products/new` یا مشابه، اگر UI دارد).
2.  اگر UI آماده نیست، از ابزارهایی مثل Postman یا دستور `curl` استفاده کنید.
3.  **Endpoint**: `POST /api/products`
4.  **Body**:
    ```json
    {
      "name": "انگشتر طلای تست",
      "priceType": "fixed",
      "originalPrice": 10000000,
      "finalPrice": 10000000,
      "stock": 5,
      "category": "gold",
      "description": "تست ایجاد محصول"
    }
    ```
5.  **نتیجه مورد انتظار**: دریافت کد `201 Created` و بازگشت اطلاعات محصول با `id`.

### ب) ویرایش محصول (Update Product)
**سناریو**: تغییر موجودی محصول به "3" عدد.
**روش تست دستی**:
1.  ID محصول ساخته شده را بردارید.
2.  **Endpoint**: `PUT /api/products/[ID]`
3.  **Body**:
    ```json
    {
      "stock": 3
    }
    ```
4.  **نتیجه مورد انتظار**: موجودی در دیتابیس آپدیت شود.

### ج) حذف محصول (Delete Product)
**سناریو**: حذف محصول تستی.
**Endpoint**: `DELETE /api/products/[ID]`

---

## 2. مدیریت انبار (Inventory)

### الف) تأثیر خرید/فروش بر انبار
*   **نکته**: در این سیستم، موجودی (`stock`) در مدل `Product` ذخیره می‌شود و مدل `Inventory` برای ورودی‌های انبار (خرید از تامین‌کننده) است.
*   **تست**:
    1.  یک رکورد `Inventory` جدید ثبت کنید (شبیه‌سازی خرید ۱۰ عدد از محصول).
    2.  بررسی کنید که آیا فیلد `stock` در جدول `Product` افزایش می‌یابد؟ (این بستگی به لاجیک `InventoryService` دارد).

---

## 3. قیمت‌گذاری پیشرفته (Advanced Pricing)

### الف) محاسبه قیمت طلا
*   اگر محصولی دارای `priceType: 'gold_based'` باشد (یا مشابه)، باید با تغییر قیمت طلا، قیمت آن تغییر کند.
*   **تست دستی**:
    1.  قیمت طلا را در `/api/gold-price/update` تغییر دهید.
    2.  محصولات وابسته را چک کنید که آیا `finalPrice` آنها تغییر کرده است؟

---

## نتایج تست‌های خودکار (Automated Verification Log)

| ردیف | مورد تست | وضعیت | توضیحات |
| :--- | :--- | :--- | :--- |
| 1 | ایجاد محصول (API/Service) | [x] | با موفقیت ایجاد شد (ID تأیید شد) |
| 2 | خواندن لیست محصولات | [x] | دیتا به درستی خوانده شد |
| 3 | محاسبه قیمت نهایی | [x] | منطق `calculateNewProductPrice` برای طلا تأیید شد |
| 4 | آپدیت محصول (موجودی) | [x] | موجودی با موفقیت تغییر کرد |

**تاریخ اجرا**: 2026-02-05
**اسکریپت**: `scripts/test-phase-2.ts`

---

## اسکریپت‌های کمکی
برای اجرای تست‌های خودکار زیر، من از اسکریپت‌های Node.js استفاده می‌کنم که می‌توانید نتایج آن را در زیر ببینید.
